import{a as J,b as We,c as P,d as Fe,e as Ue,f as Le,g as De,h as Qe,i as je,j as Xe,k as Ye,l as Ne,m as qe,n as Ge,o as $e}from"./chunk-VGIKIMWI.js";import{$ as w,C as B,D as k,E as be,F as y,G as A,I as Se,K as z,L as oe,M as v,N as Q,O as q,P as l,Q as p,R as C,S as Re,T as Ie,U as V,V as _,W as u,X as se,Y as ce,Z as he,_ as Oe,a as I,aa as ze,b as _e,c as O,d as re,da as Ee,ga as Te,h as j,ha as Ve,i as ae,j as Ce,k as Me,ka as G,la as $,ma as Pe,n as L,o as we,ra as He,s as D,sa as Be,t as ye,ua as K,v as Ae,w as d,wa as ke,x as g,y as X,z as ve}from"./chunk-GC2W3DRD.js";var ee=(()=>{let a=class a{constructor(){this.productSelected=new re(void 0),this.productSelected$=this.productSelected.asObservable(),this.imageCropped=new re(void 0),this.imageCropped$=this.imageCropped.asObservable()}selectProduct(e){this.productSelected.next(e)}cropImage(e){this.imageCropped.next(e)}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function ct(s,a){if(s&1){let c=V();l(0,"tr")(1,"div",5)(2,"td"),C(3,"img",6),p(),l(4,"td"),w(5),p()(),l(6,"td",7),X(),l(7,"svg",8),_("click",function(){let t=d(c).$implicit,i=u();return g(i.editProduct(t))}),C(8,"path",9)(9,"path",10),p(),l(10,"svg",11),_("click",function(){let t=d(c).$implicit,i=u();return g(i.deleteProduct(t))}),C(11,"path",12)(12,"path",13),p()()()}if(s&2){let c=a.$implicit;y(3),v("src",c.imagesUrl,k),y(2),ze(c.title)}}var Je=(()=>{let a=class a{constructor(e,t,i){this.api=e,this.admin=t,this.router=i}ngOnInit(){this.api.getAllProducts().subscribe(e=>this.products=e)}goToProduct(){this.admin.selectProduct(void 0),this.router.navigate(["admin-product"])}deleteProduct(e){e.images?.forEach(t=>this.api.removeImage(t.id).subscribe()),this.api.removeProduct(e.id).subscribe({next:()=>{alert("product has deleted"),this.api.getAllProducts().subscribe(t=>this.products=t)}})}editProduct(e){this.admin.selectProduct(e),this.router.navigate(["admin-product"])}};a.\u0275fac=function(t){return new(t||a)(A(J),A(ee),A(K))},a.\u0275cmp=D({type:a,selectors:[["app-admin"]],decls:9,vars:1,consts:[[1,"admin"],[1,"admin-head"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"icon",3,"click"],["d","M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"],[4,"ngFor","ngForOf"],[1,"product"],["alt","",3,"src"],[1,"actions"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"action","edit",3,"click"],["d","M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"],["fill-rule","evenodd","d","M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"action","delete",3,"click"],["d","M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"],["d","M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"p"),w(3,"List of Products"),p(),X(),l(4,"svg",2),_("click",function(){return i.goToProduct()}),C(5,"path",3),p()(),ve(),l(6,"table")(7,"tbody"),z(8,ct,13,2,"tr",4),p()()()),t&2&&(y(8),v("ngForOf",i.products))},dependencies:[G],styles:[".admin[_ngcontent-%COMP%]   .admin-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:2.6rem;border-bottom:2px solid black}.admin[_ngcontent-%COMP%]   .admin-head[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:1.6rem}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%], .admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{width:100%}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;padding:.2rem 0;border-bottom:1px solid black}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   .product[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:left}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:2.4rem}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{height:1.6rem}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{fill:red}.admin[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]{fill:#00f}"]});let s=a;return s})();var ht=["wrapper"],lt=["sourceImage"];function pt(s,a){if(s&1){let c=V();l(0,"img",5,1),_("load",function(){d(c);let t=u();return g(t.imageLoadedInView())})("mousedown",function(t){d(c);let i=u();return g(i.startMove(t,i.moveTypes.Drag))})("touchstart",function(t){d(c);let i=u();return g(i.startMove(t,i.moveTypes.Drag))})("error",function(t){d(c);let i=u();return g(i.loadImageError(t))}),p()}if(s&2){let c=u();Q("visibility",c.imageVisible?"visible":"hidden")("transform",c.safeTransformStyle),q("ngx-ic-draggable",!c.disabled&&c.allowMoveImage),v("src",c.safeImgDataUrl,k),oe("alt",c.imageAltText)}}function mt(s,a){if(s&1){let c=V();Re(0),l(1,"span",9),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"topleft"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"topleft"))}),C(2,"span",10),p(),l(3,"span",11),C(4,"span",10),p(),l(5,"span",12),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"topright"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"topright"))}),C(6,"span",10),p(),l(7,"span",13),C(8,"span",10),p(),l(9,"span",14),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottomright"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottomright"))}),C(10,"span",10),p(),l(11,"span",15),C(12,"span",10),p(),l(13,"span",16),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottomleft"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottomleft"))}),C(14,"span",10),p(),l(15,"span",17),C(16,"span",10),p(),l(17,"span",18),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"top"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"top"))}),p(),l(18,"span",19),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"right"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"right"))}),p(),l(19,"span",20),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottom"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"bottom"))}),p(),l(20,"span",21),_("mousedown",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"left"))})("touchstart",function(t){d(c);let i=u(2);return g(i.startMove(t,i.moveTypes.Resize,"left"))}),p(),Ie()}}function dt(s,a){if(s&1){let c=V();l(0,"div",6),_("keydown",function(t){d(c);let i=u();return g(i.keyboardAccess(t))}),l(1,"div",7),_("mousedown",function(t){d(c);let i=u();return g(i.startMove(t,i.moveTypes.Move))})("touchstart",function(t){d(c);let i=u();return g(i.startMove(t,i.moveTypes.Move))}),p(),z(2,mt,21,0,"ng-container",8),p()}if(s&2){let c=u();Q("top",c.cropper.y1,"px")("left",c.cropper.x1,"px")("width",c.cropper.x2-c.cropper.x1,"px")("height",c.cropper.y2-c.cropper.y1,"px")("margin-left",c.alignImage==="center"?c.marginLeft:null)("visibility",c.imageVisible?"visible":"hidden"),q("ngx-ic-round",c.roundCropper),oe("aria-label",c.cropperFrameAriaLabel),y(2),v("ngIf",!c.hideResizeSquares)}}var le=class{constructor(){this.format="png",this.output="blob",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperFrameAriaLabel="Crop photo",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(a){Object.keys(a).filter(c=>c in this).forEach(c=>this[c]=a[c]),this.validateOptions()}setOptionsFromChanges(a){Object.keys(a).filter(c=>c in this).forEach(c=>this[c]=a[c].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}},S=function(s){return s.Drag="drag",s.Move="move",s.Resize="resize",s.Pinch="pinch",s}(S||{});function gt(s){switch(s){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}function ut(s){switch(s){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}function ft(s,a){switch(s){case"ArrowUp":return{clientX:0,clientY:a*-1};case"ArrowRight":return{clientX:a,clientY:0};case"ArrowDown":return{clientX:0,clientY:a};case"ArrowLeft":default:return{clientX:a*-1,clientY:0}}}function xt(s,a,c){let e=s.width,t=s.height;a=Math.round(a),c=Math.round(c);let i=e/a,n=t/c,r=Math.ceil(i/2),o=Math.ceil(n/2),h=s.getContext("2d");if(h){let f=h.getImageData(0,0,e,t),m=h.createImageData(a,c),x=f.data,b=m.data;for(let R=0;R<c;R++)for(let E=0;E<a;E++){let W=(E+R*a)*4,H=R*n,M=0,T=0,pe=0,me=0,de=0,ge=0,ue=0,tt=Math.floor(E*i),it=Math.floor(R*n),ie=Math.ceil((E+1)*i),ne=Math.ceil((R+1)*n);ie=Math.min(ie,e),ne=Math.min(ne,t);for(let Y=it;Y<ne;Y++){let fe=Math.abs(H-Y)/o,nt=E*i,rt=fe*fe;for(let N=tt;N<ie;N++){let xe=Math.abs(nt-N)/r,F=Math.sqrt(rt+xe*xe);if(F>=1)continue;M=2*F*F*F-3*F*F+1;let U=4*(N+Y*e);ue+=M*x[U+3],pe+=M,x[U+3]<255&&(M=M*x[U+3]/250),me+=M*x[U],de+=M*x[U+1],ge+=M*x[U+2],T+=M}}b[W]=me/T,b[W+1]=de/T,b[W+2]=ge/T,b[W+3]=ue/pe}s.width=a,s.height=c,h.putImageData(m,0,0)}}function Ze(s,a){return s/100*a}var _t=(()=>{let a=class a{crop(e,t,i,n,r){let o=this.getImagePosition(e,t,i,r),h=o.x2-o.x1,f=o.y2-o.y1,m=document.createElement("canvas");m.width=h,m.height=f;let x=m.getContext("2d");if(!x)return null;i.backgroundColor!=null&&(x.fillStyle=i.backgroundColor,x.fillRect(0,0,h,f));let b=(i.transform.scale||1)*(i.transform.flipH?-1:1),R=(i.transform.scale||1)*(i.transform.flipV?-1:1),{translateH:E,translateV:W}=this.getCanvasTranslate(e,i,r),H=e.transformed;x.setTransform(b,0,0,R,H.size.width/2+E,H.size.height/2+W),x.translate(-o.x1/b,-o.y1/R),x.rotate((i.transform.rotate||0)*Math.PI/180),x.drawImage(H.image,-H.size.width/2,-H.size.height/2);let M={width:h,height:f,imagePosition:o,cropperPosition:I({},t)};i.containWithinAspectRatio&&(M.offsetImagePosition=this.getOffsetImagePosition(e,t,i,r));let T=this.getResizeRatio(h,f,i);return T!==1&&(M.width=Math.round(h*T),M.height=i.maintainAspectRatio?Math.round(M.width/i.aspectRatio):Math.round(f*T),xt(m,M.width,M.height)),n==="blob"?this.cropToBlob(M,m,i):(M.base64=m.toDataURL("image/"+i.format,this.getQuality(i)),M)}cropToBlob(e,t,i){return O(this,null,function*(){return e.blob=yield new Promise(n=>t.toBlob(n,"image/"+i.format,this.getQuality(i))),e.blob&&(e.objectUrl=URL.createObjectURL(e.blob)),e})}getCanvasTranslate(e,t,i){if(t.transform.translateUnit==="px"){let n=this.getRatio(e,i);return{translateH:(t.transform.translateH||0)*n,translateV:(t.transform.translateV||0)*n}}else return{translateH:t.transform.translateH?Ze(t.transform.translateH,e.transformed.size.width):0,translateV:t.transform.translateV?Ze(t.transform.translateV,e.transformed.size.height):0}}getRatio(e,t){return e.transformed.size.width/t.width}getImagePosition(e,t,i,n){let r=this.getRatio(e,n),o={x1:Math.round(t.x1*r),y1:Math.round(t.y1*r),x2:Math.round(t.x2*r),y2:Math.round(t.y2*r)};return i.containWithinAspectRatio||(o.x1=Math.max(o.x1,0),o.y1=Math.max(o.y1,0),o.x2=Math.min(o.x2,e.transformed.size.width),o.y2=Math.min(o.y2,e.transformed.size.height)),o}getOffsetImagePosition(e,t,i,n){let r=i.canvasRotation+e.exifTransform.rotate,o=this.getRatio(e,n),h,f;r%2?(h=(e.transformed.size.width-e.original.size.height)/2,f=(e.transformed.size.height-e.original.size.width)/2):(h=(e.transformed.size.width-e.original.size.width)/2,f=(e.transformed.size.height-e.original.size.height)/2);let m={x1:Math.round(t.x1*o)-h,y1:Math.round(t.y1*o)-f,x2:Math.round(t.x2*o)-h,y2:Math.round(t.y2*o)-f};return i.containWithinAspectRatio||(m.x1=Math.max(m.x1,0),m.y1=Math.max(m.y1,0),m.x2=Math.min(m.x2,e.transformed.size.width),m.y2=Math.min(m.y2,e.transformed.size.height)),m}getResizeRatio(e,t,i){let n=i.resizeToWidth/e,r=i.resizeToHeight/t,o=new Array;i.resizeToWidth>0&&o.push(n),i.resizeToHeight>0&&o.push(r);let h=o.length===0?1:Math.min(...o);return h>1&&!i.onlyScaleDown?h:Math.min(h,1)}getQuality(e){return Math.min(1,Math.max(0,e.imageQuality/100))}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Ct=(()=>{let a=class a{resetCropperPosition(e,t,i,n){if(e?.nativeElement)if(i.cropperStaticHeight&&i.cropperStaticWidth)t.x1=0,t.x2=n.width>i.cropperStaticWidth?i.cropperStaticWidth:n.width,t.y1=0,t.y2=n.height>i.cropperStaticHeight?i.cropperStaticHeight:n.height;else{let r=Math.min(i.cropperScaledMaxWidth,n.width),o=Math.min(i.cropperScaledMaxHeight,n.height);if(!i.maintainAspectRatio)t.x1=0,t.x2=r,t.y1=0,t.y2=o;else if(n.width/i.aspectRatio<n.height){t.x1=0,t.x2=r;let h=r/i.aspectRatio;t.y1=(n.height-h)/2,t.y2=t.y1+h}else{t.y1=0,t.y2=o;let h=o*i.aspectRatio;t.x1=(n.width-h)/2,t.x2=t.x1+h}}}move(e,t,i){let n=this.getClientX(e)-t.clientX,r=this.getClientY(e)-t.clientY;i.x1=t.x1+n,i.y1=t.y1+r,i.x2=t.x2+n,i.y2=t.y2+r}resize(e,t,i,n,r){let o=this.getClientX(e)-t.clientX,h=this.getClientY(e)-t.clientY;switch(t.position){case"left":i.x1=Math.min(Math.max(t.x1+o,i.x2-r.cropperScaledMaxWidth),i.x2-r.cropperScaledMinWidth);break;case"topleft":i.x1=Math.min(Math.max(t.x1+o,i.x2-r.cropperScaledMaxWidth),i.x2-r.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.y1+h,i.y2-r.cropperScaledMaxHeight),i.y2-r.cropperScaledMinHeight);break;case"top":i.y1=Math.min(Math.max(t.y1+h,i.y2-r.cropperScaledMaxHeight),i.y2-r.cropperScaledMinHeight);break;case"topright":i.x2=Math.max(Math.min(t.x2+o,i.x1+r.cropperScaledMaxWidth),i.x1+r.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.y1+h,i.y2-r.cropperScaledMaxHeight),i.y2-r.cropperScaledMinHeight);break;case"right":i.x2=Math.max(Math.min(t.x2+o,i.x1+r.cropperScaledMaxWidth),i.x1+r.cropperScaledMinWidth);break;case"bottomright":i.x2=Math.max(Math.min(t.x2+o,i.x1+r.cropperScaledMaxWidth),i.x1+r.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.y2+h,i.y1+r.cropperScaledMaxHeight),i.y1+r.cropperScaledMinHeight);break;case"bottom":i.y2=Math.max(Math.min(t.y2+h,i.y1+r.cropperScaledMaxHeight),i.y1+r.cropperScaledMinHeight);break;case"bottomleft":i.x1=Math.min(Math.max(t.x1+o,i.x2-r.cropperScaledMaxWidth),i.x2-r.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.y2+h,i.y1+r.cropperScaledMaxHeight),i.y1+r.cropperScaledMinHeight);break;case"center":let f=e.scale,m=Math.min(Math.max(r.cropperScaledMinWidth,Math.abs(t.x2-t.x1)*f),r.cropperScaledMaxWidth),x=Math.min(Math.max(r.cropperScaledMinHeight,Math.abs(t.y2-t.y1)*f),r.cropperScaledMaxHeight);i.x1=t.clientX-m/2,i.x2=t.clientX+m/2,i.y1=t.clientY-x/2,i.y2=t.clientY+x/2,i.x1<0?(i.x2-=i.x1,i.x1=0):i.x2>n.width&&(i.x1-=i.x2-n.width,i.x2=n.width),i.y1<0?(i.y2-=i.y1,i.y1=0):i.y2>n.height&&(i.y1-=i.y2-n.height,i.y2=n.height);break}r.maintainAspectRatio&&this.checkAspectRatio(t.position,i,n,r)}checkAspectRatio(e,t,i,n){let r=0,o=0;switch(e){case"top":t.x2=t.x1+(t.y2-t.y1)*n.aspectRatio,r=Math.max(t.x2-i.width,0),o=Math.max(0-t.y1,0),(r>0||o>0)&&(t.x2-=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y1+=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"bottom":t.x2=t.x1+(t.y2-t.y1)*n.aspectRatio,r=Math.max(t.x2-i.width,0),o=Math.max(t.y2-i.height,0),(r>0||o>0)&&(t.x2-=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y2-=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"topleft":t.y1=t.y2-(t.x2-t.x1)/n.aspectRatio,r=Math.max(0-t.x1,0),o=Math.max(0-t.y1,0),(r>0||o>0)&&(t.x1+=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y1+=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"topright":t.y1=t.y2-(t.x2-t.x1)/n.aspectRatio,r=Math.max(t.x2-i.width,0),o=Math.max(0-t.y1,0),(r>0||o>0)&&(t.x2-=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y1+=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"right":case"bottomright":t.y2=t.y1+(t.x2-t.x1)/n.aspectRatio,r=Math.max(t.x2-i.width,0),o=Math.max(t.y2-i.height,0),(r>0||o>0)&&(t.x2-=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y2-=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"left":case"bottomleft":t.y2=t.y1+(t.x2-t.x1)/n.aspectRatio,r=Math.max(0-t.x1,0),o=Math.max(t.y2-i.height,0),(r>0||o>0)&&(t.x1+=o*n.aspectRatio>r?o*n.aspectRatio:r,t.y2-=o*n.aspectRatio>r?o:r/n.aspectRatio);break;case"center":t.x2=t.x1+(t.y2-t.y1)*n.aspectRatio,t.y2=t.y1+(t.x2-t.x1)/n.aspectRatio;let h=Math.max(0-t.x1,0),f=Math.max(t.x2-i.width,0),m=Math.max(t.y2-i.height,0),x=Math.max(0-t.y1,0);(h>0||f>0||m>0||x>0)&&(t.x1+=m*n.aspectRatio>h?m*n.aspectRatio:h,t.x2-=x*n.aspectRatio>f?x*n.aspectRatio:f,t.y1+=x*n.aspectRatio>f?x:f/n.aspectRatio,t.y2-=m*n.aspectRatio>h?m:h/n.aspectRatio);break}}getClientX(e){return"touches"in e&&e.touches[0]?e.touches[0].clientX:"clientX"in e?e.clientX:0}getClientY(e){return"touches"in e&&e.touches[0]?e.touches[0].clientY:"clientX"in e?e.clientY:0}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Mt="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==";function wt(){return new Promise(s=>{let a=new Image;a.onload=()=>{let c=a.width===1&&a.height===2;s(c)},a.src=Mt})}function yt(s){switch(typeof s=="object"&&(s=At(s)),s){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function At(s){let a=new DataView(s);if(a.getUint16(0,!1)!==65496)return-2;let c=a.byteLength,e=2;for(;e<c;){if(a.getUint16(e+2,!1)<=8)return-1;let t=a.getUint16(e,!1);if(e+=2,t==65505){if(a.getUint32(e+=2,!1)!==1165519206)return-1;let i=a.getUint16(e+=6,!1)==18761;e+=a.getUint32(e+4,i);let n=a.getUint16(e,i);e+=2;for(let r=0;r<n;r++)if(a.getUint16(e+r*12,i)==274)return a.getUint16(e+r*12+8,i)}else{if((t&65280)!==65280)break;e+=a.getUint16(e,!1)}}return-1}var vt=(()=>{let a=class a{constructor(){this.autoRotateSupported=wt()}loadImageFile(e,t){return O(this,null,function*(){let i=yield e.arrayBuffer();return yield this.checkImageTypeAndLoadImageFromArrayBuffer(i,e.type,t)})}checkImageTypeAndLoadImageFromArrayBuffer(e,t,i){return this.isValidImageType(t)?this.loadImageFromArrayBuffer(e,i,t):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(e)}loadImageFromURL(e,t){return O(this,null,function*(){let n=yield(yield fetch(e)).blob(),r=yield n.arrayBuffer();return yield this.loadImageFromArrayBuffer(r,t,n.type)})}loadBase64Image(e,t){let i=this.base64ToArrayBuffer(e);return this.loadImageFromArrayBuffer(i,t)}base64ToArrayBuffer(e){e=e.replace(/^data:([^;]+);base64,/gmi,"");let t=atob(e),i=t.length,n=new Uint8Array(i);for(let r=0;r<i;r++)n[r]=t.charCodeAt(r);return n.buffer}loadImageFromArrayBuffer(e,t,i){return O(this,null,function*(){let n=yield new Promise((r,o)=>O(this,null,function*(){try{let h=new Blob([e],i?{type:i}:void 0),f=URL.createObjectURL(h),m=new Image,b=i==="image/svg+xml"?yield this.getSvgImageSize(h):void 0;m.onload=()=>r({originalImage:m,originalImageSize:b,originalObjectUrl:f,originalArrayBuffer:e}),m.onerror=o,m.src=f}catch(h){o(h)}}));return yield this.transformImageFromArrayBuffer(n,t,n.originalImageSize!=null)})}getSvgImageSize(e){return O(this,null,function*(){let n=new DOMParser().parseFromString(yield e.text(),"image/svg+xml").querySelector("svg");if(!n)throw Error("Failed to parse SVG image");let r=n.getAttribute("width"),o=n.getAttribute("height");if(r&&o)return null;let h=n.getAttribute("viewBox")||n.getAttribute("viewbox");if(h){let f=h.split(" ");return{width:+f[2],height:+f[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")})}transformImageFromArrayBuffer(e,t,i=!1){return O(this,null,function*(){let n=yield this.autoRotateSupported,r=yt(n?-1:e.originalArrayBuffer);if(!e.originalImage||!e.originalImage.complete)return Promise.reject(new Error("No image loaded"));let o={original:{objectUrl:e.originalObjectUrl,image:e.originalImage,size:e.originalImageSize??{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:r};return this.transformLoadedImage(o,t,i)})}transformLoadedImage(e,t,i=!1){return O(this,null,function*(){let n=t.canvasRotation+e.exifTransform.rotate,r=e.original.size;if(!i&&n===0&&!e.exifTransform.flip&&!t.containWithinAspectRatio)return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:I({},r)},transformed:{objectUrl:e.original.objectUrl,image:e.original.image,size:I({},r)},exifTransform:e.exifTransform};let o=this.getTransformedSize(r,e.exifTransform,t),h=document.createElement("canvas");h.width=o.width,h.height=o.height;let f=h.getContext("2d");f?.setTransform(e.exifTransform.flip?-1:1,0,0,1,h.width/2,h.height/2),f?.rotate(Math.PI*(n/2)),f?.drawImage(e.original.image,-r.width/2,-r.height/2);let m=yield new Promise(R=>h.toBlob(R,t.format));if(!m)throw new Error("Failed to get Blob for transformed image.");let x=URL.createObjectURL(m),b=yield this.loadImageFromObjectUrl(x);return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:I({},r)},transformed:{objectUrl:x,image:b,size:{width:b.width,height:b.height}},exifTransform:e.exifTransform}})}loadImageFromObjectUrl(e){return new Promise((t,i)=>{let n=new Image;n.onload=()=>t(n),n.onerror=i,n.src=e})}getTransformedSize(e,t,i){let n=i.canvasRotation+t.rotate;if(i.containWithinAspectRatio)if(n%2){let r=e.width*i.aspectRatio,o=e.height/i.aspectRatio;return{width:Math.max(e.height,r),height:Math.max(e.width,o)}}else{let r=e.height*i.aspectRatio,o=e.width/i.aspectRatio;return{width:Math.max(e.width,r),height:Math.max(e.height,o)}}return n%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),te=(()=>{let a=class a{constructor(e,t,i,n,r,o,h){this.cropService=e,this.cropperPositionService=t,this.loadImageService=i,this.sanitizer=n,this.cd=r,this.zone=o,this.hammerLoader=h,this.settings=new le,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=S,this.imageVisible=!1,this.cropperFrameAriaLabel=this.settings.cropperFrameAriaLabel,this.output=this.settings.output,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new B,this.startCropImage=new B,this.imageLoaded=new B,this.cropperReady=new B,this.loadImageFailed=new B,this.transformChange=new B,this.reset()}ngOnChanges(e){this.onChangesUpdateSettings(e),this.onChangesInputImage(e),this.loadedImage?.original.image.complete&&(e.containWithinAspectRatio||e.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t)),(e.cropper||e.maintainAspectRatio||e.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.maintainAspectRatio&&(this.resetCropOnAspectRatioChange||!this.aspectRatioIsCorrect())&&(e.maintainAspectRatio||e.aspectRatio)?this.resetCropperPosition():e.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop())),e.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop()),e.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(e){this.settings.setOptionsFromChanges(e),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&(this.hideResizeSquares=!0,this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1}))}onChangesInputImage(e){(e.imageChangedEvent||e.imageURL||e.imageBase64||e.imageFile)&&this.reset(),e.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),e.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),e.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),e.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){let e=this.imageChangedEvent?.target?.files;return e instanceof FileList&&e.length>0}setCssTransform(){let e=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${e}, ${this.transform.translateV||0}${e}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(e){this.loadImageService.loadImageFile(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}loadBase64Image(e){this.loadImageService.loadBase64Image(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}loadImageFromURL(e){this.loadImageService.loadImageFromURL(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}setLoadedImage(e){this.loadedImage=e,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e.transformed.objectUrl),this.cd.markForCheck()}loadImageError(e){console.error(e),this.loadImageFailed.emit()}imageLoadedInView(){this.loadedImage!=null&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit(I({},this.maxSize)),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){if(this.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{let e=I({},this.maxSize);this.setMaxSize(),this.resizeCropperPosition(e),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}}activatePinchGesture(){return O(this,null,function*(){yield this.hammerLoader?.();let e=window?.Hammer||null;if(e){let t=new e(this.wrapper.nativeElement);t.get("pinch").set({enable:!0}),t.on("pinchmove",this.onPinch.bind(this)),t.on("pinchend",this.pinchStop.bind(this)),t.on("pinchstart",this.startPinch.bind(this))}else Te()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")})}resizeCropperPosition(e){(e.width!==this.maxSize.width||e.height!==this.maxSize.height)&&(this.cropper.x1=this.cropper.x1*this.maxSize.width/e.width,this.cropper.x2=this.cropper.x2*this.maxSize.width/e.width,this.cropper.y1=this.cropper.y1*this.maxSize.height/e.height,this.cropper.y2=this.cropper.y2*this.maxSize.height/e.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings,this.maxSize),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(e){this.changeKeyboardStepSize(e),this.keyboardMoveCropper(e)}changeKeyboardStepSize(e){let t=+e.key;t>=1&&t<=9&&(this.settings.stepSize=t)}keyboardMoveCropper(e){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(e.key))return;let i=e.shiftKey?S.Resize:S.Move,n=e.altKey?ut(e.key):gt(e.key),r=ft(e.key,this.settings.stepSize);e.preventDefault(),e.stopPropagation(),this.startMove({clientX:0,clientY:0},i,n),this.handleMouseMove(r),this.handleMouseUp()}startMove(e,t,i=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===S.Pinch||t===S.Drag&&!this.allowMoveImage||("preventDefault"in e&&e.preventDefault(),this.moveStart=I({active:!0,type:t,position:i,transform:I({},this.transform),clientX:this.cropperPositionService.getClientX(e),clientY:this.cropperPositionService.getClientY(e)},this.cropper),this.initMouseMove())}initMouseMove(){ae(j(document,"mousemove"),j(document,"touchmove")).pipe(Me(ae(j(document,"mouseup"),j(document,"touchend")).pipe(Ce()))).subscribe({next:e=>this.zone.run(()=>{this.handleMouseMove(e),this.cd.markForCheck()}),complete:()=>this.zone.run(()=>{this.handleMouseUp(),this.cd.markForCheck()})})}startPinch(e){this.safeImgDataUrl&&(e.preventDefault&&e.preventDefault(),this.moveStart=I({active:!0,type:S.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2},this.cropper))}handleMouseMove(e){if(this.moveStart.active){if("stopPropagation"in e&&e.stopPropagation(),"preventDefault"in e&&e.preventDefault(),this.moveStart.type===S.Move)this.cropperPositionService.move(e,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===S.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===S.Drag){let t=this.cropperPositionService.getClientX(e)-this.moveStart.clientX,i=this.cropperPositionService.getClientY(e)-this.moveStart.clientY;this.transform=_e(I({},this.transform),{translateH:(this.moveStart.transform?.translateH||0)+t,translateV:(this.moveStart.transform?.translateV||0)+i}),this.setCssTransform()}}}onPinch(e){this.moveStart.active&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.moveStart.type===S.Pinch&&(this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.markForCheck())}setMaxSize(){if(this.sourceImage){let e=getComputedStyle(this.sourceImage.nativeElement);this.maxSize.width=parseFloat(e.width),this.maxSize.height=parseFloat(e.height),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.maintainAspectRatio?this.settings.cropperScaledMinHeight=Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?this.settings.cropperScaledMinHeight=Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):this.settings.cropperScaledMinHeight=20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){let e=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/e:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/e:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(e=!1){this.cropper.x1<0&&(this.cropper.x2-=e?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=e?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=e?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=e?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}handleMouseUp(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===S.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(e=this.settings.output){if(this.loadedImage?.transformed?.image!=null){if(this.startCropImage.emit(),e==="blob")return this.cropToBlob();if(e==="base64")return this.cropToBase64()}return null}cropToBlob(){return new Promise((e,t)=>this.zone.run(()=>O(this,null,function*(){let i=yield this.cropService.crop(this.loadedImage,this.cropper,this.settings,"blob",this.maxSize);i?(this.imageCropped.emit(i),e(i)):t("Crop image failed")})))}cropToBase64(){let e=this.cropService.crop(this.loadedImage,this.cropper,this.settings,"base64",this.maxSize);return e?(this.imageCropped.emit(e),e):null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}};a.\u0275fac=function(t){return new(t||a)(A(_t),A(Ct),A(vt),A(Be),A(Ve),A(Se),A(He,8))},a.\u0275cmp=D({type:a,selectors:[["image-cropper"]],viewQuery:function(t,i){if(t&1&&(se(ht,7),se(lt,5)),t&2){let n;ce(n=he())&&(i.wrapper=n.first),ce(n=he())&&(i.sourceImage=n.first)}},hostVars:6,hostBindings:function(t,i){t&1&&_("resize",function(){return i.onResize()},!1,be),t&2&&(Q("text-align",i.alignImage),q("disabled",i.disabled)("ngx-ix-hidden",i.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},standalone:!0,features:[Ae,Ee],decls:5,vars:10,consts:[["wrapper",""],["sourceImage",""],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(t,i){t&1&&(l(0,"div",null,0),z(2,pt,2,8,"img",2),C(3,"div",3),z(4,dt,3,16,"div",4),p()),t&2&&(Q("background",i.imageVisible&&i.backgroundColor),y(2),v("ngIf",i.safeImgDataUrl),y(),Q("width",i.maxSize.width,"px")("height",i.maxSize.height,"px")("margin-left",i.alignImage==="center"?i.marginLeft:null),y(),v("ngIf",i.imageVisible))},dependencies:[$],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535c;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0});let s=a;return s})();function St(s,a){if(s&1&&C(0,"img",34),s&2){let c=a.$implicit;v("src",c,k)}}function Rt(s,a){if(s&1&&(l(0,"div",29),z(1,St,1,1,"img",30),X(),l(2,"svg",31),C(3,"path",32)(4,"path",33),p()()),s&2){let c=u();y(),v("ngForOf",c.product==null?null:c.product.imagesUrl)}}function It(s,a){if(s&1&&(l(0,"div",29),C(1,"img",35),p()),s&2){let c=u();y(),v("src",c.croppedImageUrl,k)}}var et=(()=>{let a=class a{constructor(e,t,i,n){this.fb=e,this.api=t,this.router=i,this.admin=n,this.height=546,this.width=364,this.aspectRatio=this.width/this.height,this.imageChangedEvent=null,this.productForm=this.fb.group({gender:[null,P.required],brand:[null,P.required],category:[null,P.required],title:[null,P.required],colors:[null,P.required],sizes:[null,P.required],price:[null,P.required],priceAfterDiscount:[null]})}ngOnInit(){this.admin.productSelected$.subscribe(e=>{this.product=e,this.productForm.patchValue({gender:e?.gender,brand:e?.brand,category:e?.category,title:e?.title,colors:e?.colors,sizes:e?.sizes,price:e?.price,priceAfterDiscount:e?.priceAfterDiscount})}),this.admin.imageCropped$.subscribe(e=>{console.log(e),this.croppedImage=e})}onSubmit(){this.product?(console.log("edit"),this.api.editProduct(this.product.id,this.product)):(console.log("add"),this.api.addProduct(this.productForm.value).subscribe({next:e=>{alert("added"),this.api.uploadImage(this.croppedImage,e.id).subscribe({next:()=>alert("image uploaded")})},error:()=>alert("error")}))}fileChangeEvent(e){this.imageChangedEvent=e}imageCropped(e){this.croppedImage=e.blob,this.croppedImageUrl=e.objectUrl}addImage(){this.router.navigate(["/admin-image"])}deleteImage(e){this.api.removeImage(e)}};a.\u0275fac=function(t){return new(t||a)(A(Ge),A(J),A(K),A(ee))},a.\u0275cmp=D({type:a,selectors:[["app-admin-product"]],decls:45,vars:10,consts:[["inputField",""],[1,"admin-product"],[3,"formGroup"],["formControlName","gender"],["value","WOMEN"],["value","MEN"],["type","text","placeholder","Brand","formControlName","brand"],["type","text","placeholder","Category","formControlName","category"],["type","text","placeholder","Title","formControlName","title"],["formControlName","colors","multiple",""],["value","black"],["value","white"],["value","blue"],["value","red"],["formControlName","sizes","multiple",""],["value","XS"],["value","S"],["value","M"],["value","L"],["value","XL"],["value","XXL"],["type","number","placeholder","Price","formControlName","price"],["type","number","placeholder","Price After Discount","formControlName","priceAfterDiscount"],[1,"images"],["class","image",4,"ngIf"],[1,"image","image-add",3,"click"],["type","file","accept","image/*","hidden","",3,"change"],["format","jpeg",3,"imageCropped","imageChangedEvent","maintainAspectRatio","aspectRatio","resizeToHeight","resizeToWidth"],["type","submit",3,"click","disabled","value"],[1,"image"],["alt","",3,"src",4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 16 16",1,"delete"],["d","M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"],["d","M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"],["alt","",3,"src"],[3,"src"]],template:function(t,i){if(t&1){let n=V();l(0,"h1"),w(1,"Add Product"),p(),l(2,"div",1)(3,"form",2)(4,"select",3)(5,"option",4),w(6,"WOMEN"),p(),l(7,"option",5),w(8,"MEN"),p()(),C(9,"input",6)(10,"input",7)(11,"input",8),l(12,"select",9)(13,"option",10),w(14,"Black"),p(),l(15,"option",11),w(16,"White"),p(),l(17,"option",12),w(18,"Blue"),p(),l(19,"option",13),w(20,"Red"),p()(),l(21,"select",14)(22,"option",15),w(23,"XS"),p(),l(24,"option",16),w(25,"S"),p(),l(26,"option",17),w(27,"M"),p(),l(28,"option",18),w(29,"L"),p(),l(30,"option",19),w(31,"XL"),p(),l(32,"option",20),w(33,"XXL"),p()(),C(34,"input",21)(35,"input",22),l(36,"div",23),z(37,Rt,5,1,"div",24)(38,It,2,1,"div",24),l(39,"div",25),_("click",function(){d(n);let o=Oe(42);return g(o.click())}),w(40,"+"),p()(),l(41,"input",26,0),_("change",function(o){return d(n),g(i.fileChangeEvent(o))}),p(),l(43,"image-cropper",27),_("imageCropped",function(o){return d(n),g(i.imageCropped(o))}),p(),l(44,"input",28),_("click",function(){return d(n),g(i.onSubmit())}),p()()()}t&2&&(y(3),v("formGroup",i.productForm),y(34),v("ngIf",i.product==null?null:i.product.imagesUrl),y(),v("ngIf",i.croppedImageUrl),y(5),v("imageChangedEvent",i.imageChangedEvent)("maintainAspectRatio",!0)("aspectRatio",i.aspectRatio)("resizeToHeight",i.height)("resizeToWidth",i.width),y(),v("disabled",!(i.productForm.valid&&i.croppedImageUrl))("value",i.product?"EDIT":"ADD"))},dependencies:[Le,Ye,qe,We,De,Xe,Ne,Fe,Ue,Qe,je,G,$,te],styles:[".admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.2rem 1rem;width:100%}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);width:100%;gap:.2rem}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{position:relative}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   .delete[_ngcontent-%COMP%]{fill:red;position:absolute;height:1rem;bottom:0;right:0}.admin-product[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]   .image-add[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:4rem;width:100%;background-color:#d3d3d3}"]});let s=a;return s})();var Ot=[{path:"admin",component:Je},{path:"admin-product",component:et}],ri=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=ye({type:a}),a.\u0275inj=we({imports:[ke.forChild(Ot),$e,Pe,te]});let s=a;return s})();export{ri as AdminModule};
